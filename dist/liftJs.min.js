function isDefined(e){return void 0!==e}var app={config:{},core:{},isReady:!1,init:function(){var e=null;e=isDefined(app.config.host)?app.config.host:location.protocol.concat("//").concat(window.location.host),$.get(e+(app.config.parametersPath?app.config.parametersPath:"/data/parameters.json"),function(e){app.config=e,app.core.utils.init(),app.core.events.init(),app.core.session.start()}),$(document).on("session.started",function(){app.core.ui.registerModulesTemplates(),app.core.ui.initTemplates()}),$(document).on("templates.registered",function(){app.core.ui.plugins.init(),app.core.ui.init(),app.ready()})},ready:function(){$(document).trigger("app.ready")},register:function(e){return $.extend(!0,app,e),app},moduleExists:function(e){return app.core.utils.deepFind(app,e)}};app.register({ctrl:{states:{home:{path:"/",title:app.config.applicationName}},homeAction:function(){app.core.ctrl.go("home",{}).then(function(){app.core.history.add(app.ctrl.states.home)})}},core:{ctrl:{go:function(e,t){return $(document).trigger("ctrl.beforego"),app.core.ctrl.render(e,t,!0)},render:function(e,t,n){var i=$.Deferred();return $(document).trigger("ctrl.prerender"),isDefined(t)&&null!==t||(t={}),isDefined(n)||(n=!1),n&&(app.core.ui.clearContent(),app.core.ui.displayContentLoading(!0)),app.core.ui.applyTemplate(e,t),$(".dropdown-button").dropdown("close"),$(document).trigger("ctrl.postrender"),i.resolve(),i.promise()}}}}),app.register({core:{events:{init:function(){$(document).on("app.ready",function(e){app.isReady=!0,app.core.ui.displayContentLoading(!1)}).on("click","*[data-go]",function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),$(document).trigger("ctrl.beforego");var t=$(this).attr("data-go")+"Action",n=$(this).attr("data-go-args");(0,app.ctrl[t])(n=isDefined(n)&&null!==n&&""!==n?JSON.parse(n):void 0)}).on("submit","form[data-ws], form[data-ctrl]",function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault();var t=null;if($(this).attr("data-ws"))t=app.ws[$(this).attr("data-ws")];else{if(!$(this).attr("data-ctrl"))return void app.core.ui.toast("Mauvais callable de traitement de formulaire","error");t=app.ctrl[$(this).attr("data-ctrl")+"Action"]}t(app.core.utils.formToObject($(this)),$(this))}).on("click",'[href="#"]',function(e){return e.preventDefault(),!1}).on("template.applied",function(e,t){app.isReady&&app.core.ui.displayContentLoading(!1),app.core.ui.plugins.init();var n=$('handlebars-template[name="'+t+'"]').find("form");if(n.length>0&&n.is(":visible"))try{Materialize.updateTextFields()}catch(e){}}),!0===app.config.debug&&(window.onerror=function(e,t,n,i,r){app.core.ui.toast("DEBUG: "+e+"<br/>"+t+":"+n+":"+i,"error")}),app.core.events.registerComponentEvents(app)},registerComponentEvents:function(e,t){isDefined(t)||(t=0),t>4||Object.keys(e).forEach(function(n){var i=e[n];isDefined(i)&&i&&i.hasOwnProperty("initEvents")?i.initEvents():i&&"object"==typeof i&&app.core.events.registerComponentEvents(i,t+1)})}}}}),app.register({core:{history:{currentState:null,currentCallable:function(){},provider:window.history,disableBack:!1,add:function(e){var t=app.core.history.provider.state;if(null===t||t.state.path!==e.path){var n=$("#app").html();app.core.history.provider.pushState({content:n,state:e},e.title,app.config.appUriPrefix+e.path),app.core.history.currentState=e}},initEvents:function(){$(window).on("popstate",function(e){var t=e.originalEvent.state;t&&!app.core.history.disableBack&&($("#app").html(t.content),$(document).trigger("history.popedstate"))}),$(document).on("history.popedstate",function(){app.core.ui.plugins.init(),$(".dropdown-button").dropdown("close")})}}}}),app.register({core:{routing:{getCurrentUri:function(){e=window.location.pathname;if(app.config.appUriPrefix.match(/^\?/))e=window.location.search;else if(app.config.appUriPrefix.match(/^\#/))var e=window.location.hash;return e},findState:function(e){var t=null;return $.each(app.ctrl.states,function(n,i){app.config.appUriPrefix+i.path===e&&((t=i).action=n+"Action")}),t},initEvents:function(){$(document).on("app.ready",function(){var e=app.core.routing.getCurrentUri(),t=app.core.routing.findState(e);t&&(0,app.ctrl[t.action])()})}}}}),app.register({core:{session:{initEvents:function(){},start:function(){null===app.core.sessionStorage.get(app.config.clientSessionName)?app.core.session.save():app.core.session.reload(),$(document).trigger("session.started")},save:function(){null===app.core.sessionStorage.engine&&app.core.session.start(),app.core.sessionStorage.set(app.config.clientSessionName,JSON.stringify(app.core.session))},destroy:function(){app.core.sessionStorage.set(app.config.clientSessionName,JSON.stringify({}))},reload:function(){null===app.core.sessionStorage.engine&&app.core.session.start();var e=app.core.sessionStorage.get(app.config.clientSessionName);null!==e&&(e=JSON.parse(e)),$.extend(app.core.session,e)}},sessionStorage:{engine:sessionStorage,get:function(e){return app.core.sessionStorage.engine.getItem(e)},set:function(e,t){var n=app.core.sessionStorage.engine.setItem(e,t);return app.core.session.reload(),n},remove:function(e){return app.core.sessionStorage.engine.removeItem(e)}}}}),app.register({core:{settings:{}},ctrl:{states:{settings:{path:"/settings",title:"Paramètres"}},settingsAction:function(){app.core.history.currentCallable=app.ctrl.showSettings,app.core.ctrl.go("settings").then(function(){try{Materialize.updateTextFields()}catch(e){}app.core.history.add(app.ctrl.states.settings)})},updateSettings:function(e){app.core.ui.toast("Paramètres enregistrés","success"),app.ctrl.homeAction()}}}),app.register({core:{ui:{templates:{},init:function(){$(document).trigger("ui.init")},initEvents:function(){},plugins:{init:function(){moment.locale("fr"),app.core.ui.setApplicationName(),app.core.ui.plugins.initTabs(),app.core.ui.plugins.initTooltips(),app.core.ui.plugins.initDropDown(),app.core.ui.plugins.registerComponentPlugins(app)},initTabs:function(){$("ul#tabs").tabs();var e=$("div.tab-content:first-of-type").attr("id");$("ul#tabs").tabs("select_tab",e)},initTooltips:function(){$(".material-tooltip").remove(),$("*[data-tooltip]").tooltip({delay:50})},initDropDown:function(){$(".dropdown-button").dropdown()},registerComponentPlugins:function(e,t){isDefined(t)||(t=0),t>3||typeof e===Object&&Object.keys(e).forEach(function(n){var i=e[n];i&&i.hasOwnProperty("initPlugins")?i.initPlugins():"object"==typeof i&&app.core.ui.plugins.registerComponentPlugins(i,t+1)})}},setApplicationName:function(){var e=app.config.applicationName;document.title=e,$("nav .brand-logo").html(e)},registerModulesTemplates:function(e,t){isDefined(e)||(e=app),isDefined(t)||(t=0),t>3||Object.keys(e).forEach(function(n){var i=e[n];i&&i.hasOwnProperty("registerTemplates")?i.registerTemplates():i&&"object"==typeof i&&app.core.ui.registerModulesTemplates(i,t+1)})},initTemplates:function(){var e=[];$("handlebars-template").each(function(){var t=$.Deferred(),n=$(this),i=n.attr("name"),r=n.attr("src");e.push(t.promise()),isDefined(r)?$.ajax({async:!0,url:r,success:function(e){app.core.ui.templates[i]={id:i,data:e,element:n},$(document).trigger("template.registered",[app.core.ui.templates[i]]),t.resolve()}}):(app.core.ui.templates[i]={id:i,data:n.html(),element:n},$(document).trigger("template.registered",[app.core.ui.templates[i]]),t.resolve())}),$.when.apply($,e).then(function(){$(document).trigger("templates.registered")},function(e){$(document).trigger("app.failed")})},addTemplate:function(e,t,n){var i=$("#app"),r="prepend";"content"===e&&(i=i.find(".content"),r="append");var a=i.find('handlebars-template[name="'+t+'"]');0!=a.length&&"true"!==a.attr("override")&&(a.remove(),delete app.core.ui.templates[t]),"true"!==a.attr("override")&&i[r]($("<handlebars-template/>").attr({name:t,src:n}))},applyTemplate:function(e,t){$('handlebars-template[name="'+e+'"]').html(app.core.ui.renderTemplate(e,t)),$(document).trigger("template.applied",[e])},renderTemplate:function(e,t){return void 0!==app.core.ui.templates[e]&&Handlebars.compile(app.core.ui.templates[e].data)(t)},clearContent:function(){$("#app div.content handlebars-template").html(""),$(document).trigger("content.cleared")},displayContentLoading:function(e){isDefined(e)||(e=!0);var t=$("#contentLoader");!0===e?t.show():t.hide()},toast:function(e,t,n){switch(isDefined(n)||(n=5e3),isDefined(t)||(t="default"),t){case"info":icon='<i class="material-icons right">info</i>';break;case"warning":icon='<i class="material-icons right">warning</i>';break;case"error":icon='<i class="material-icons right">error</i>';break;case"success":icon='<i class="material-icons right">check_circle</i>';break;default:icon='<i class="material-icons right">notifications</i>'}Materialize.toast(e+icon,n,t)}}}}),app.register({core:{utils:{init:function(){Handlebars.registerHelper("ifCond",function(e,t,n,i){switch(t){case"==":return e==n?i.fn(this):i.inverse(this);case"===":return e===n?i.fn(this):i.inverse(this);case"!=":return e!=n?i.fn(this):i.inverse(this);case"!==":return e!==n?i.fn(this):i.inverse(this);case"<":return e<n?i.fn(this):i.inverse(this);case"<=":return e<=n?i.fn(this):i.inverse(this);case">":return e>n?i.fn(this):i.inverse(this);case">=":return e>=n?i.fn(this):i.inverse(this);case"&&":return e&&n?i.fn(this):i.inverse(this);case"||":return e||n?i.fn(this):i.inverse(this);case"null":return null===e?n.fn(this):n.inverse(this);case"not null":return null!==e?n.fn(this):n.inverse(this);default:return i.inverse(this)}}),Handlebars.registerHelper("formatDate",function(e,t){return moment(e).format(t)}),Handlebars.registerHelper("ouiNon",function(e){return e?'<span class="teal badge white-text">Oui</span>':'<span class="red badge">Non</span>'}),Handlebars.registerHelper("config",function(e){return app.core.utils.deepFind(app.config,e)}),Handlebars.registerHelper("render",function(e,t){return app.core.ui.renderTemplate(e,t)}),Handlebars.registerHelper("dump",function(e){console.debug(e)})},formToObject:function(e){Array.isArray(e)||$(e).is("form")&&(e=$(e).serializeArray());for(var t={},n=0;n<e.length;n++){var i=e[n].value;"true"!=i&&"false"!=i||(i="true"==i),t[e[n].name]=i}return t},ucfirst:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},parseDate:function(e,t){return isDefined(t)?moment(e,t).toDate():moment(e).toDate()},deepFind:function(e,t){var n,i=t.split("."),r=e;for(n=0;n<i.length;++n){if("undefined"===r[i[n]]||null===r[i[n]])return null;r=r[i[n]]}return r},uuidV1:function(e){return e+uuid.v1()},uuidV4:function(e){return e+uuid.v4()},mergeArrays:function(e,t){return e.concat(t.filter(function(t){return-1===e.indexOf(t)}))}}}});